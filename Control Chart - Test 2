//Test if current point and one of two previous points is above 2SD
IF ([Total Daily Calories] > (WINDOW_AVG([Total Daily Calories])+2*WINDOW_STDEV([Total Daily Calories]))
AND
(LOOKUP([Total Daily Calories],-1)>(WINDOW_AVG([Total Daily Calories])+2*WINDOW_STDEV([Total Daily Calories]))
OR  //only need one value to be true
LOOKUP([Total Daily Calories],-2)>(WINDOW_AVG([Total Daily Calories])+2*WINDOW_STDEV([Total Daily Calories]))))

//Test the preceeding 2 observations
OR
(LOOKUP([Total Daily Calories],-1)>(WINDOW_AVG([Total Daily Calories])+2*WINDOW_STDEV([Total Daily Calories]))
AND
LOOKUP([Total Daily Calories],-2)>(WINDOW_AVG([Total Daily Calories])+2*WINDOW_STDEV([Total Daily Calories])))

THEN [Total Daily Calories]

//Test if current point and one of two previous points is below 2SD

ELSEIF ([Total Daily Calories]<(WINDOW_AVG([Total Daily Calories])-2*WINDOW_STDEV([Total Daily Calories]))
AND
(LOOKUP([Total Daily Calories],-1)<(WINDOW_AVG([Total Daily Calories])-2*WINDOW_STDEV([Total Daily Calories]))
OR //only need one value to be true
LOOKUP([Total Daily Calories],-2)<(WINDOW_AVG([Total Daily Calories])-2*WINDOW_STDEV([Total Daily Calories]))))

//Test the preceeding 2 observations
OR
(LOOKUP([Total Daily Calories],-1)<(WINDOW_AVG([Total Daily Calories])-2*WINDOW_STDEV([Total Daily Calories]))
AND
LOOKUP([Total Daily Calories],-2)<(WINDOW_AVG([Total Daily Calories])-2*WINDOW_STDEV([Total Daily Calories])))

THEN [Total Daily Calories]

ELSE NULL

END
